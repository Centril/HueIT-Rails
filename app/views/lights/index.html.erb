<!DOCTYPE html>

<html>
	<head>
		<%= stylesheet_link_tag "materialize, table" %>
		<%= javascript_include_tag 'materialize, draw_lightbulb' %>
		<script type="text/javascript">
			$(document).ready(function() { 
				draw("color_shower");
			});
			function switchOnOff(i) {
				changeUrl = "/lights/" + parseInt(i) + "/switchOnOff"
				$.ajax({
					url: changeUrl,
					type: 'GET'
				});
			}
			
		</script>
	</head>

	<body >
	<% if current_user.present? %>
		<div class = "container">
		<main>
			<h1 class="center-align">HueIT</h1>

			<div class ="row">
				<div class="col s12 offset-s3">
					<div class = "row">
            <table class="">


              <% @lights.each do |light| %>
                <tr>
                  <td><div class="bulb" style="margin:0 auto; background-color: <%= light.rgb %>;"> </div></td>
                  <td>	
                  		<!-- Switch -->
					  <div class="switch">
					    <label>
					      Off
					      <input type="checkbox" onclick="switchOnOff(<%= light.id%>)">
					      <span class="lever"></span>
					      On
					    </label>
					  </div>
                  </td>
                </tr>
              <% end %>
            </table>
					</div>

					<div class="light_picker">
						<%= form_tag(multi_update_lights_path) do %>
							<div class="section">
								<p><%= label_tag("Brightness") %></p>
								<%= range_field_tag :bri, 254, in: 0..254, class: 'update col s8', oninput:'draw("color_shower");'%>
								<%= text_field_tag :bri, 254, class: 'update col s2', onkeypress:'draw("color_shower");'%>
							</div><br><br>

							<div class="section">
								<p><%= label_tag("Hue") %></p>
								<%= range_field_tag :hue, 65535,in: 0..65535, class: 'update col s8', oninput:'draw("color_shower");'%>
								<%= text_field_tag :hue, 65535, class: 'update col s2', onkeypress:'draw("color_shower");' %>
							</div><br><br>
							<div class="section">
								<p><%= label_tag(:sat, "Saturation:") %></p>
								<%= range_field_tag :sat, 254, in: 0..254, class: 'update col s8', oninput:'draw("color_shower");' %>
								<%= text_field_tag :sat, 254, class: 'update col s2', onkeypress:'draw("color_shower");' %>
							</div><br><br>
							<div class="hubben-pic">
								<% @lights.each_with_index do |light, i| %>
									<div>
										<%= check_box_tag "lights[#{light.id}]", true, true, style: "right: #{40 + i/3 * 60}px; top: #{100 +  i%3 * 50}px" %>
										<%= label_tag nil, nil, for: "lights_#{light.id}", style: "right: #{40 + i/3 * 60}px; top: #{100 +  i%3 * 50}px"%>
									</div>
								<% end %>
							</div>
							<%= submit_tag "Change", :class => "waves-effect btn "  %>
						<% end %>
					</div>
					<canvas id="color_shower" width="300" height="400">
					</canvas>
					</div>
				</div>
			</div>
			</main>
			</div>
	<% end %>
	</body>
</html>

